<!DOCTYPE html>
<html lang="en">
    <head>
       <script src="https://d3js.org/d3.v4.min.js"></script>
       <script src="https://cdnjs.cloudflare.com/ajax/libs/matter-js/0.12.0/matter.js"></script>
       <script src="pages.js"></script>
    </head>
    <body>

        <script>
            var socket = new WebSocket("ws://192.168.0.24:8888");

            // variables tracking the switch states
            var red_s = false;
            var green_s = false;
            var blue_s = false;


            window.onbeforeunload = function(event){
                socket.close();
            }


            var Engine = Matter.Engine,
                Render = Matter.Render,
                World = Matter.World,
                Bodies = Matter.Bodies;
                 
            var engine = Engine.create();
             
            var render = Render.create({
                            element: document.body,
                            engine: engine,
                            options: {
                                width: 1600,
                                height: 800,
                                //background: 'transparent',
                                background: 'black',
                                wireframes: false
                            }
                         });
                          
            var ground = Bodies.rectangle(800, 800, 1600, 20, { isStatic: true });
            var left_wall = Bodies.rectangle(0, 800, 20, 150, { isStatic: true });
            var right_wall = Bodies.rectangle(1600, 800, 20, 150, { isStatic: true });
             
            socket.onmessage = function (event) {
                console.log(event.data);
                switch (event.data) {
                   case "r1":
                    red_s = true;
                   break;

                   case "r0":
                    red_s = false;
                   break;

                   case "g1":
                    green_s = true;
                   break;

                   case "g0":
                    green_s = false;
                   break;

                   case "b1":
                    blue_s = true;
                   break;

                   case "b0":
                    blue_s = false;
                   break;

                   default:
                    console.log("Error: unknown command from the console");
                }
            }


            var intervalId = setInterval(addCircles, 150);

            //World.add(engine.world, [ballA, ballB, ground]);
            World.add(engine.world, [ground, left_wall, right_wall]);
             
            Engine.run(engine);
            Render.run(render);

            function addCircles() {

                    // the red button has been pressed
                    if(red_s) {
                        var rand_x = Math.floor(Math.random() * 1600);
                        var red_ball = Matter.Bodies.circle(rand_x, 5, 10, {
                          density: 0.005,
                          friction: 0.01,
                          frictionAir: 0.00001,
                          restitution: 0.8,
                          render: {
                            fillStyle: 'red'
                          }
                        })
                        World.add(engine.world, [red_ball]);
                    }
        
                    
                    // the green button has been pressed
                    if(green_s) {
                        var rand_x = Math.floor(Math.random() * 1600);
                        var green_ball = Matter.Bodies.circle(rand_x, 5, 20, {
                          density: 0.04,
                          friction: 0.01,
                          frictionAir: 0.00001,
                          restitution: 0.8,
                          render: {
                            fillStyle: 'green'
                          }
                        })
                        World.add(engine.world, [green_ball]);
                    }

                
                    // the blue button has been pressed
                    if(blue_s) {
                        var rand_x = Math.floor(Math.random() * 1600);
                        var blue_ball = Matter.Bodies.circle(rand_x, 5, 40, {
                          density: 0.32,
                          friction: 0.01,
                          frictionAir: 0.00001,
                          restitution: 0.8,
                          render: {
                            fillStyle: 'blue'
                          }
                        })
                        World.add(engine.world, [blue_ball]);
                    }

            } // end of the add circles function
                

             // end condition -- after 30 seconds load a new page
             //setTimeout( function() {
             //                         var page = pages[Math.floor(Math.random()*pages.length)];
             //                         while(page == 'simple_lines.html') { page = pages[Math.floor(Math.random()*pages.length)]; }
             //                         document.location.href = page;
             //                       }, 50000);

        </script>

    </body>
</html>
